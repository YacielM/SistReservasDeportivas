@{
    ViewData["Title"] = "Clientes";
}

<div id="app" class="container mt-4">
    <h2 class="mb-3">Clientes</h2>

    <!-- Formulario de nuevo cliente -->
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="card-title">Agregar Cliente</h5>
            <div class="row g-2">
                <div class="col-md-3">
                    <input v-model="nuevo.dni" placeholder="DNI" class="form-control" />
                </div>
                <div class="col-md-3">
                    <input v-model="nuevo.nombre" placeholder="Nombre" class="form-control" />
                </div>
                <div class="col-md-3">
                    <input v-model="nuevo.apellido" placeholder="Apellido" class="form-control" />
                </div>
                <div class="col-md-3">
                    <input v-model="nuevo.email" placeholder="Email" class="form-control" />
                </div>
            </div>
            <div class="mt-3">
                <button @@click="crearCliente" class="btn btn-success">
                    <i class="bi bi-person-plus"></i> Guardar
                </button>
            </div>
        </div>
    </div>

    <!-- Tabla de clientes -->
    <table class="table table-striped table-hover align-middle">
        <thead>
            <tr>
                <th>DNI</th>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Email</th>
                <th style="width: 200px;"></th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="c in clientes" :key="c.idCliente">
                <td>{{ c.dni }}</td>
                <td>{{ c.nombre }}</td>
                <td>{{ c.apellido }}</td>
                <td>{{ c.email }}</td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <button @@click="editarCliente(c)" class="btn btn-warning">
                            <i class="bi bi-pencil-square"></i> Editar
                        </button>
                        <button @@click="eliminarCliente(c.idCliente)" class="btn btn-danger">
                            <i class="bi bi-trash"></i> Eliminar
                        </button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    clientes: [],
                    nuevo: { dni: '', nombre: '', apellido: '', email: '' }
                };
            },
            mounted() {
                this.cargarClientes();
            },
            methods: {
                async cargarClientes() {
                    const res = await axios.get('/api/ClientesApi');
                    this.clientes = res.data;
                },
                async crearCliente() {
                    if (!this.nuevo.dni || !this.nuevo.nombre || !this.nuevo.apellido) {
                        alert("Completa DNI, Nombre y Apellido");
                        return;
                    }
                    await axios.post('/api/ClientesApi', this.nuevo);
                    this.nuevo = { dni: '', nombre: '', apellido: '', email: '' };
                    this.cargarClientes();
                },
                async eliminarCliente(id) {
                    if (confirm("Â¿Seguro que deseas eliminar este cliente?")) {
                        await axios.delete(`/api/ClientesApi/${id}`);
                        this.cargarClientes();
                    }
                },
                async editarCliente(cliente) {
                    const nuevoNombre = prompt("Nuevo nombre:", cliente.nombre);
                    if (nuevoNombre) {
                        cliente.nombre = nuevoNombre;
                        await axios.put(`/api/ClientesApi/${cliente.idCliente}`, cliente);
                        this.cargarClientes();
                    }
                }
            }
        }).mount('#app');
    </script>
}
